# üì∏ Screenshot Database System

## Overview

The screenshot system now includes **persistent database storage** with **visual comparison capabilities**. Screenshots are stored in a SQLite database for historical tracking and can be compared between different dates.

## Features

### üóÑÔ∏è Database Storage
- **SQLite Database**: All screenshots stored in `screenshots.db`
- **Metadata Tracking**: URL, timestamp, file size, success status
- **Date-based Organization**: Screenshots organized by capture date
- **Automatic Cleanup**: Old screenshots (30+ days) automatically removed

### üìä Visual Comparison
- **Side-by-side Layout**: Compare screenshots from different dates
- **Date Selection**: Interactive date pickers for before/after comparison
- **Responsive Design**: Works on desktop and mobile devices
- **URL Bookmarking**: Shareable comparison URLs with date parameters

### üîß Management Tools
- **Database Statistics**: View available dates and screenshot counts
- **Export Functionality**: Export screenshots to filesystem
- **Cleanup Utilities**: Remove old screenshots automatically

## Database Schema

```sql
CREATE TABLE screenshots (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date TEXT NOT NULL,           -- YYYY-MM-DD format
    page_name TEXT NOT NULL,      -- e.g., "home-page", "shopping-bag"
    url TEXT NOT NULL,           -- Original URL captured
    filename TEXT NOT NULL,      -- e.g., "home-page.jpg"
    image_data BLOB,             -- Binary image data (Base64 encoded in HTML)
    metadata TEXT,               -- JSON metadata (timestamp, file_size, etc.)
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(date, page_name)
);
```

## File Structure

```
screenshots/
‚îú‚îÄ‚îÄ screenshots.db              # SQLite database with all screenshot data
‚îú‚îÄ‚îÄ screenshots.html            # Main comparison interface (database-driven)
‚îú‚îÄ‚îÄ screenshot_viewer.html      # Standalone viewer (generated by screenshot_viewer.py)
‚îú‚îÄ‚îÄ home-page.jpg              # Screenshot files (also stored in DB)
‚îú‚îÄ‚îÄ home-search.jpg
‚îú‚îÄ‚îÄ shopping-bag.jpg
‚îú‚îÄ‚îÄ wishlist.jpg
‚îî‚îÄ‚îÄ [other page screenshots...]

scripts/
‚îú‚îÄ‚îÄ screenshot_tool.py         # Main screenshot capture tool (saves to DB)
‚îú‚îÄ‚îÄ screenshot_viewer.py       # Standalone viewer generator
‚îî‚îÄ‚îÄ screenshot_db_manager.py   # Database management utilities
```

## Usage

### 1. Capture Screenshots (with Database Storage)
```bash
# Run screenshot tool (saves to both filesystem and database)
python3 screenshot_tool.py

# Or with environment variables
KMART_USERNAME="user@example.com" KMART_PASSWORD="password" python3 screenshot_tool.py
```

### 2. View Comparison Interface
```bash
# Generate standalone viewer
python3 screenshot_viewer.py

# Or open screenshots/screenshots.html directly in browser
open screenshots/screenshots.html
```

### 3. Database Management
```bash
# Show database statistics
python3 screenshot_db_manager.py --stats

# Clean up old screenshots (older than 30 days)
python3 screenshot_db_manager.py --cleanup 30

# Export all screenshots to filesystem
python3 screenshot_db_manager.py --export ./exported_screenshots
```

## Integration with GitHub Pages

The screenshot system is **fully integrated** into the main dashboard:

1. **Screenshots Tab**: New tab in main dashboard showing comparison interface
2. **Database Persistence**: `screenshots.db` deployed to GitHub Pages
3. **Historical Tracking**: Compare today's screenshots with previous days
4. **Automatic Updates**: New screenshots automatically added to database during deployment

## URL Parameters for Bookmarking

The comparison interface supports URL parameters for direct linking:

```
https://your-username.github.io/Site-Health/screenshots/screenshots.html?before=2025-10-26&after=2025-10-27
```

## Screenshots Captured

The system captures these pages:

### Public Pages (Before Login)
- **Home Page** (`home-page`) - https://www.kmart.com.au/
- **Home & Living Category** (`home-living-category`) - Category page
- **Product Page** (`ceramic-candle-product`) - Specific product
- **Clearance Category** (`clearance-category`) - Clearance section
- **Search Overlay** (`home-search`) - Search functionality

### Authenticated Pages (After Login)
- **Shopping Bag** (`shopping-bag`) - Cart/checkout page
- **Wishlist** (`wishlist`) - User wishlist

## Development

### Adding New Pages
1. Add URL to `PUBLIC_URLS` or `AUTHENTICATED_URLS` in `screenshot_tool.py`
2. Add mapping in `screenshot_names` dictionary
3. Update database schema if needed

### Customizing Comparison
- Modify date selection logic in `generate_html()` function
- Update styling in HTML templates
- Add new metadata fields to database schema

## Troubleshooting

### Database Issues
```bash
# Check database integrity
python3 screenshot_db_manager.py --stats

# Clean and rebuild if needed
rm screenshots.db
python3 screenshot_tool.py  # Will recreate database
```

### Missing Screenshots
```bash
# Check what's in database
python3 screenshot_db_manager.py --stats

# Export to verify images are stored
python3 screenshot_db_manager.py --export ./debug_export
```

### GitHub Pages Issues
- Ensure `screenshots.db` is included in deployment
- Check that iframe paths are correct (`screenshots/screenshots.html`)
- Verify database file is accessible via HTTP

## Future Enhancements

- [ ] Image diffing to highlight visual changes
- [ ] Screenshot scheduling and automation
- [ ] Performance metrics comparison
- [ ] Mobile vs desktop screenshot comparison
- [ ] Failed screenshot retry logic
